<!-- FILTERS ROW - Full Width -->
<div class="card grid-margin">
  <div class="card-body pb-0">
    <div class="row g-3">
      <!-- Factory Filter -->
      <div class="col-md-3 mb-2" *ngIf="accessToFactories">
        <label class="form-label d-flex align-items-center">
          <!-- <i class="fas fa-industry me-2 text-primary"></i> -->
          Plant
        </label>
        <ng-select [items]="FactoriesDropDown" [loading]="!FactoriesDropDown" [searchable]="false" bindLabel="name"
          bindValue="id" placeholder="Select Plant" [(ngModel)]="selectedplant" class="w-100"></ng-select>
      </div>

      <!-- Date Picker -->
      <div class="col-md-3">
        <label class="form-label d-flex align-items-center">
          <!-- <i class="fas fa-calendar-alt me-2 text-primary"></i> -->
          Select Date
        </label>
        <div class="input-group">
          <input class="form-control" placeholder="yyyy-mm-dd" name="datepicker" [(ngModel)]="selectedDate"
            ngbDatepicker #dp="ngbDatepicker" (dateSelect)="
              GetPlanShiftMaterialConsumptionsBySpecificDate(
                selectedDate,
                selectedplant
              )
            " readonly />
          <button class="btn btn-outline-secondary" type="button" (click)="dp.toggle()">
            <i class="fas fa-calendar-alt"></i>
          </button>
        </div>
      </div>

      <!-- Spacer -->
      <div class="col-md-6 d-flex justify-content-end">
        <div class="text-muted small align-self-end">
          <!-- <i class="fas fa-info-circle me-1"></i> -->
          <!-- Select plant and date to load production plan -->
        </div>
      </div>
    </div>
  </div>
</div>

<!-- TABLE CARD - Full Width -->
<div class="card grid-margin">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0 d-flex align-items-center">
      <!-- <i class="fas fa-list-ul me-2 text-primary"></i> -->
      Production Plan
    </h5>
    <div class="text-muted small">
      {{ getPlanShiftMaterialConsumptions?.length || 0 }} records
    </div>
  </div>

  <div class="card-body p-0">
    <!-- LOADING STATE -->
    <div *ngIf="getPlanShiftMaterialConsumptions?.length === 0"
      class="d-flex flex-column align-items-center justify-content-center py-5">
      <div class="spinner-border text-primary mb-3" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
      <p class="text-muted">No data available for selected filters.</p>
    </div>

    <!-- TABLE -->
    <div *ngIf="getPlanShiftMaterialConsumptions?.length !== 0" class="table-responsive">
      <table class="table table-hover mb-0">
        <thead class="table-light">
          <tr>
            <th scope="col">
              <!-- <i class="fas fa-building me-1"></i> -->
              Factory
            </th>
            <th scope="col">
              <!-- <i class="fas fa-stream me-1"></i> -->
              Line
            </th>
            <th scope="col">
              <!-- <i class="fas fa-calendar-day me-1">

            </i> -->
              Day
            </th>
            <th scope="col">
              <!-- <i class="fas fa-barcode me-1"></i>  -->
              SKU
            </th>
            <th scope="col">
              <!-- <i class="fas fa-hashtag me-1"></i>  -->
              Target
            </th>
            <th scope="col" class="text-center" style="width: 120px">
              <!-- <i class="fas fa-cogs me-1"></i> -->
              Actions
            </th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="
              let item of getPlanShiftMaterialConsumptions
                | paginate
                  : {
                      itemsPerPage: tableSize,
                      currentPage: page,
                      totalItems: count
                    }
            ">
            <td>{{ item?.factoryName }}</td>
            <td>{{ item?.lineName }}</td>
            <td>{{ item?.day | date : "medium" }}</td>
            <td>{{ item?.skuName || "-" }}</td>
            <td class="fw-bold">{{ item?.target }}</td>
            <td class="text-center">
              <div class="btn-group" role="group">
                <button *ngIf="hasAccessToEditProductionPlan()" type="button" class="btn btn-sm rounded-2"
                  (click)="openBasicModal(edit, item); getId(item.id)" title="Edit Record">
                  <i class="fas fa-pen"></i>
                </button>
                <button *ngIf="hasAccessToDeleteProductionPlan()" type="button" class="btn btn-sm rounded-2"
                  [disabled]="loadonDelete" (click)="delete(item)" title="Delete Record">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- PAGINATION -->
    <div *ngIf="getPlanShiftMaterialConsumptions?.length !== 0" class="card-footer bg-white py-3">
      <pagination-template #p="paginationApi" (pageChange)="onTableDataChange($event)">
        <div class="d-flex justify-content-between align-items-center w-100 px-2 py-3">

          <!-- LEFT: Previous Button -->
          <div>
            <button type="button" class="btn btn-sm btn-outline-secondary" [disabled]="p.isFirstPage()"
              (click)="p.previous()" title="Previous Page">
              <i class="fas fa-chevron-left"></i> Prev
            </button>
          </div>

          <!-- CENTER: Simple Pagination Numbers -->
          <div class="text-center">
            <span *ngFor="let page of p.pages" class="mx-1 px-2 py-1 rounded border"
              [class.bg-primary]="p.getCurrent() === page.value" [class.text-white]="p.getCurrent() === page.value"
              [class.border-secondary]="p.getCurrent() !== page.value" style="cursor: pointer;"
              (click)="p.setCurrent(page.value)" title="Go to page {{ page.value }}">
              {{ page.label }}
            </span>
          </div>

          <!-- RIGHT: Next Button -->
          <div>
            <button type="button" class="btn btn-sm btn-outline-secondary" [disabled]="p.isLastPage()"
              (click)="p.next()" title="Next Page">
              Next <i class="fas fa-chevron-right"></i>
            </button>
          </div>

        </div>
      </pagination-template>
    </div>


    <!-- <div
      *ngIf="getPlanShiftMaterialConsumptions?.length !== 0"
      class="card-footer bg-white py-3"
    >
      <div>
        <pagination-template
          #p="paginationApi"
          (pageChange)="onTableDataChange($event)"
        >
          <div
            class="d-flex justify-content-between align-items-center w-100 px-2 py-3"
          >

            <div>
              <button
                type="button"
                class="btn btn-sm btn-outline-secondary"
                [disabled]="p.isFirstPage()"
                (click)="p.previous()"
                title="Previous Page"
              >
                <i class="fas fa-chevron-left"></i> Prev
              </button>
            </div>


            <div class="d-flex flex-wrap justify-content-center gap-1">
              <button
                *ngFor="let page of p.pages"
                type="button"
                class="btn btn-sm"
                [class.btn-primary]="p.getCurrent() === page.value"
                [class.btn-outline-secondary]="p.getCurrent() !== page.value"
                (click)="p.setCurrent(page.value)"
                title="Go to page {{ page.value }}"
              >
                {{ page.label }}
              </button>
            </div>


            <div>
              <button
                type="button"
                class="btn btn-sm btn-outline-secondary"
                [disabled]="p.isLastPage()"
                (click)="p.next()"
                title="Next Page"
              >
                Next <i class="fas fa-chevron-right"></i>
              </button>
            </div>
          </div>
        </pagination-template>
      </div>
    </div> -->
  </div>
</div>

<!-- MODAL -->
<ng-template #edit let-modal>
  <div class="modal-header bg-light">
    <h5 class="modal-title">
      <i class="fas fa-edit me-2 text-primary"></i> Edit Production Plan
    </h5>
    <button type="button" class="btn-close" (click)="modal.close('by: close icon')" aria-label="Close"></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="editProductPlanningForm" (ngSubmit)="OnEdit()">
      <div class="row g-3">
        <div class="col-md-4">
          <label class="form-label d-flex align-items-center">
            <i class="fas fa-industry me-2"></i> Plant
          </label>
          <ng-select [items]="FactoriesDropDown" [loading]="!FactoriesDropDown" [searchable]="false" bindLabel="name"
            bindValue="id" placeholder="Select Plant" formControlName="factoryId" [(ngModel)]="selectedplant1"
            (change)="lineID(selectedplant1)" class="w-100"></ng-select>
        </div>

        <div class="col-md-4">
          <label class="form-label d-flex align-items-center">
            <i class="fas fa-stream me-2"></i> Line
          </label>
          <ng-select [items]="LineDropDown" [searchable]="false" bindLabel="name" bindValue="id"
            placeholder="Select Line" formControlName="lineId" [(ngModel)]="selectedLine" class="w-100"></ng-select>
        </div>

        <div class="col-md-4">
          <label class="form-label d-flex align-items-center">
            <i class="fas fa-barcode me-2"></i> SKU
          </label>
          <ng-select [items]="skuId" [searchable]="false" bindLabel="name" bindValue="sku" placeholder="Select SKU"
            formControlName="skuName" class="w-100"></ng-select>
        </div>

        <div class="col-md-6">
          <label class="form-label d-flex align-items-center">
            <i class="fas fa-calendar-alt me-2"></i> Day
          </label>
          <input formControlName="day" class="form-control" type="date" [value]="editdate | date : 'yyyy-MM-dd'" />
        </div>

        <div class="col-md-6">
          <label class="form-label d-flex align-items-center">
            <i class="fas fa-bullseye me-2"></i> Target
          </label>
          <input formControlName="target" class="form-control" type="number" placeholder="Enter target quantity" />
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" (click)="modal.close('Cancel')">
      <i class="fas fa-times me-1"></i> Cancel
    </button>
    <button class="btn btn-primary" (click)="OnEdit()" [disabled]="editProductPlanningForm.invalid">
      <i class="fas fa-save me-1"></i> Save Changes
    </button>
  </div>
</ng-template>