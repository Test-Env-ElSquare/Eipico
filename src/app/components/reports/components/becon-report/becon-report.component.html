<!-- becon-report.component.html -->
<div class="becon-report-container">
  <!-- Summary Cards (Top Section) -->
  <div class="row mb-4 g-4">
    <!-- Total Beacons -->
    <div class="col-xl-4 col-md-6">
      <div class="card summary-card">
        <div class="card-body">
          <!-- 1. Icon + Header -->
          <div class="d-flex align-items-center mb-3">
            <mat-icon class="icon-lg text-primary me-3">router</mat-icon>
            <h6 class="text-muted mb-0">Total Beacons</h6>
          </div>
          <!-- 2. Large Number -->
          <h2 class="mb-3 fw-bold">{{ totalBecons + totalBeconsU || 0 }}</h2>
          <!-- 3. Timestamp -->
          <div class="timestamp-badge d-flex align-items-center">
            <mat-icon class="time-icon me-2">schedule</mat-icon>
            <small class="text-muted">Last updated: {{ lastUpdated | date : "short" }}</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Active -->
    <div class="col-xl-4 col-md-6">
      <div class="card summary-card">
        <div class="card-body">
          <!-- 1. Icon + Header -->
          <div class="d-flex align-items-center mb-3">
            <mat-icon class="icon-lg text-success me-3">check_circle</mat-icon>
            <h6 class="text-muted mb-0">Active</h6>
          </div>
          <!-- 2. Large Number -->
          <h2 class="mb-3 fw-bold">{{ totalActive + totalActiveU || 0 }}</h2>
          <!-- 3. Timestamp -->
          <div class="timestamp-badge d-flex align-items-center">
            <mat-icon class="time-icon me-2">schedule</mat-icon>
            <small class="text-muted">Last updated: {{ lastUpdated | date : "short" }}</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Inactive -->
    <div class="col-xl-4 col-md-6">
      <div class="card summary-card">
        <div class="card-body">
          <!-- 1. Icon + Header -->
          <div class="d-flex align-items-center mb-3">
            <mat-icon class="icon-lg text-danger me-3">cancel</mat-icon>
            <h6 class="text-muted mb-0">Inactive</h6>
          </div>
          <!-- 2. Large Number -->
          <h2 class="mb-3 fw-bold">
            {{ totalInactive + totalInactiveU || 0 }}
          </h2>
          <!-- 3. Timestamp -->
          <div class="timestamp-badge d-flex align-items-center">
            <mat-icon class="time-icon me-2">schedule</mat-icon>
            <small class="text-muted">Last updated: {{ lastUpdated | date : "short" }}</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Production Section -->
  <div class="table-responsive table-wrapper">
    <table class="table table-hover table-striped mb-0">
      <thead class="table-light">
        <tr>
          <th (click)="sortProduction('machineName')">
            Machine Name <mat-icon>{{ getSortIcon("machineName") }}</mat-icon>
          </th>
          <th (click)="sortProduction('beacon_Status')">
            Status <mat-icon>{{ getSortIcon("beacon_Status") }}</mat-icon>
          </th>
          <th (click)="sortProduction('timeStamp')">
            Last Active <mat-icon>{{ getSortIcon("timeStamp") }}</mat-icon>
          </th>
        </tr>
      </thead>

      <!-- IMPORTANT: استخدمي الـ filteredProductionMachines بدال paginated -->
      <tbody>
        <tr *ngFor="let machine of filteredProductionMachines">
          <td>{{ machine.machineName }}</td>
          <td>
            <span class="badge rounded-pill px-3 py-2" [ngClass]="{
              'bg-danger': machine.beacon_Status === 'OffLine',
              'bg-success': machine.beacon_Status === 'OnLine'
            }">
              {{ machine.beacon_Status }}
            </span>
          </td>
          <td>{{ machine.timeStamp | date : "medium" }}</td>
        </tr>

        <tr *ngIf="filteredProductionMachines.length === 0">
          <td colspan="3" class="text-center py-3 text-muted">
            No machines found
          </td>
        </tr>
      </tbody>
    </table>
  </div>


  <!-- Utilities Section -->
  <div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
      <h3 class="m-0">Utilities Machines</h3>
      <div class="d-flex align-items-center">
        <input type="text" class="form-control me-2" placeholder="Search machines..." [(ngModel)]="searchUtilities"
          (input)="filterUtilities()" />
        <div class="expand-toggle" (click)="toggleUtilities()">
          {{ showUtilities ? "Collapse" : "Expand" }}
          <mat-icon>{{
            showUtilities ? "keyboard_arrow_up" : "keyboard_arrow_down"
            }}</mat-icon>
        </div>
      </div>
    </div>
    <div class="card-body p-0" [@collapse]="showUtilities ? 'expanded' : 'collapsed'">
      <div class="table-responsive table-wrapper">
        <table class="table table-hover table-striped mb-0">
          <thead class="table-light">
            <tr>
              <th scope="col" (click)="sortUtilities('name')">
                Machine Name <mat-icon>{{ getSortIcon("name") }}</mat-icon>
              </th>
              <th scope="col" (click)="sortUtilities('status')">
                Status <mat-icon>{{ getSortIcon("status") }}</mat-icon>
              </th>
              <th scope="col" (click)="sortUtilities('timeStamp')">
                Last Active <mat-icon>{{ getSortIcon("timeStamp") }}</mat-icon>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let machine of filteredUtilitiesMachines">
              <td>{{ machine.name }}</td>
              <td>
                <span class="badge rounded-pill px-3 py-2" [ngClass]="{
                    'bg-danger': machine.status === 'OFFLINE',
                    'bg-success': machine.status === 'ONLINE',
                    'bg-secondary': machine.status === 'N/A'
                  }">
                  {{ machine.status }}
                </span>
              </td>
              <td>{{ machine.timeStamp | date : "medium" }}</td>
            </tr>
            <tr *ngIf="filteredUtilitiesMachines.length === 0">
              <td colspan="3" class="text-center py-3 text-muted">
                No machines found
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    <!-- Pagination Controls for Utilities -->
    <!-- <div class="card-footer d-flex justify-content-between align-items-center py-3">
      <div>
        Showing {{ (currentPageUtilities - 1) * itemsPerPageUtilities + 1 }} to
        {{ getEndItemUtilities() }} of
        {{ filteredUtilitiesMachines.length }} entries
      </div>
      <nav>
        <ul class="pagination mb-0">
          <li class="page-item" [class.disabled]="currentPageUtilities === 1">
            <button class="page-link" (click)="goToPageUtilities(1)" [disabled]="currentPageUtilities === 1">
              First
            </button>
          </li>
          <li class="page-item" [class.disabled]="currentPageUtilities === 1">
            <button class="page-link" (click)="previousPageUtilities()" [disabled]="currentPageUtilities === 1">
              ‹
            </button>
          </li>
          <li class="page-item" *ngFor="let page of getPageNumbersUtilities()"
            [class.active]="page === currentPageUtilities">
            <button class="page-link" (click)="goToPageUtilities(page)">
              {{ page }}
            </button>
          </li>

          <li class="page-item" [class.disabled]="currentPageUtilities === totalPagesUtilities">
            <button class="page-link" (click)="nextPageUtilities()"
              [disabled]="currentPageUtilities === totalPagesUtilities">
              ›
            </button>
          </li>
          <li class="page-item" [class.disabled]="currentPageUtilities === totalPagesUtilities">
            <button class="page-link" (click)="goToPageUtilities(totalPagesUtilities)"
              [disabled]="currentPageUtilities === totalPagesUtilities">
              Last
            </button>
          </li>
        </ul>
      </nav>
    </div> -->
  </div>
</div>