<div class="container-fluid">
  <!-- Header Row -->
  <div
    class="d-flex flex-wrap justify-content-between align-items-center gap-3 mb-4"
  >
    <!-- LEFT SIDE: Search Bar -->
    <div class="position-relative" style="width: 320px">
      <input
        type="text"
        class="form-control ps-5"
        placeholder="Search Item Code, Name..."
        [(ngModel)]="searchText"
        (input)="onSearchChange($event)"
      />
      <i
        class="fas fa-search position-absolute top-50 translate-middle-y ms-3 text-muted"
      ></i>
    </div>

    <!-- RIGHT SIDE: Delete Selected + Add Button -->
    <div class="d-flex align-items-center gap-3">
      <!-- Delete Selected Button -->
      <button
        *ngIf="selectedItems.length > 0"
        class="btn btn-danger d-flex align-items-center gap-2"
        (click)="deleteSelected()"
      >
        <i class="fas fa-trash-alt"></i>
        ({{ selectedItems.length }})
      </button>

      <!-- Add Button -->
      <button
        class="btn btn-primary d-flex align-items-center gap-2"
        (click)="openAddForm(addForm)"
      >
        <i class="fas fa-plus"></i> New Materials
      </button>
    </div>
  </div>

  <!-- Table Card -->
  <div class="card shadow-sm">
    <div class="card-body p-0">
      <div class="table-responsive">
        <table class="table table-hover mb-0 align-middle">
          <thead class="table-light">
            <tr>
              <th class="ps-4" style="width: 50px">
                <div class="form-check mb-0">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    [checked]="
                      selectedItems.length ===
                        (
                          AllMaterials
                          | search : searchText
                          | paginate
                            : {
                                itemsPerPage: tableSize,
                                currentPage: page,
                                totalItems: count
                              }
                        ).length &&
                      (
                        AllMaterials
                        | search : searchText
                        | paginate
                          : {
                              itemsPerPage: tableSize,
                              currentPage: page,
                              totalItems: count
                            }
                      ).length > 0
                    "
                    (change)="onSelectAll($event)"
                  />
                </div>
              </th>
              <th>Item Code</th>
              <th>Name</th>
              <th class="text-end pe-4">Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="
                let item of AllMaterials
                  | search : searchText
                  | paginate
                    : {
                        itemsPerPage: tableSize,
                        currentPage: page,
                        totalItems: count
                      }
              "
              [class.table-active]="isItemSelected(item)"
            >
              <td class="ps-4">
                <div class="form-check mb-0">
                  <input
                    class="form-check-input"
                    type="checkbox"
                    [checked]="isItemSelected(item)"
                    (change)="toggleSelection(item)"
                  />
                </div>
              </td>
              <td>{{ item.itemCode }}</td>
              <td>{{ item.name }}</td>
              <td class="text-end pe-4">
                <div class="btn-group btn-group-sm" role="group">
                  <!-- Edit -->
                  <button
                    *ngIf="HasAccessToEditMaterial()"
                    type="button"
                    (click)="openLg(content, item)"
                    class="btn btn btn-sm rounded-2"
                    title="Edit"
                  >
                    <i class="fas fa-pen"></i>
                  </button>
                  <!-- Delete Single -->
                  <button
                    *ngIf="HasAccessToDeleteMaterial()"
                    type="button"
                    (click)="delete(item.id)"
                    class="btn btn-sm rounded-2"
                    title="Delete"
                  >
                    <i class="fas fa-trash-alt"></i>
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Pagination -->
  <div class="d-flex justify-content-end mt-3">
    <pagination-controls
      previousLabel="Prev"
      nextLabel="Next"
      (pageChange)="onTableDataChange($event)"
    ></pagination-controls>
  </div>
</div>

<!-- Edit Modal -->
<ng-template #content let-modal>
  <div class="modal-header border-bottom">
    <h5 class="modal-title">{{ updatedModalTitle }}</h5>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="editedForm">
      <div class="row g-3">
        <div class="col-md-6">
          <label for="name" class="form-label">Name</label>
          <input
            type="text"
            class="form-control"
            formControlName="name"
            id="name"
          />
        </div>
        <div class="col-md-6">
          <label for="itemCode" class="form-label">Item Code</label>
          <input
            type="text"
            class="form-control"
            formControlName="itemCode"
            id="itemCode"
          />
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer border-top">
    <button
      type="button"
      class="btn btn-secondary"
      (click)="modal.close('Close click')"
    >
      Cancel
    </button>
    <button
      type="button"
      class="btn btn-primary"
      (click)="modal.close('Close click'); onUpdate(editedForm.value)"
    >
      Save
    </button>
  </div>
</ng-template>

<!-- Add Modal -->
<ng-template #addForm let-modal>
  <div class="modal-header border-bottom">
    <h5 class="modal-title">Add New Material</h5>
    <button
      type="button"
      class="btn-close"
      aria-label="Close"
      (click)="modal.dismiss('Cross click')"
    ></button>
  </div>
  <div class="modal-body">
    <form [formGroup]="AddMaterialForm">
      <div class="row g-3">
        <div class="col-md-6">
          <label for="name" class="form-label">NAME</label>
          <input
            type="text"
            class="form-control"
            formControlName="name"
            id="name"
          />
        </div>
        <div class="col-md-6">
          <label for="itemCode" class="form-label">ITEM CODE</label>
          <input
            type="text"
            class="form-control"
            formControlName="itemCode"
            id="itemCode"
          />
        </div>
      </div>
    </form>
  </div>
  <div class="modal-footer border-top">
    <button
      type="button"
      class="btn btn-secondary"
      (click)="modal.dismiss('Close click')"
    >
      Cancel
    </button>
    <button
      type="submit"
      class="btn btn-dark"
      (click)="add(); modal.close('Close click')"
    >
      Add
    </button>
  </div>
</ng-template>
