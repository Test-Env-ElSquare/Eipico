<nav class="sidebar" [class.sidebar-collapsed]="isCollapsed">
  <div class="sidebar-header">
    <!-- Logo -->
    <a
      routerLink="/"
      class="sidebar-brand nobleui-logo"
      aria-label="Go to homepage"
    >
      <span class="logo-text" [class.collapsed]="isCollapsed"
        >MES Genies AI</span
      >
    </a>

    <!-- Toggler Button -->
    <button
      class="sidebar-toggler active"
      type="button"
      #sidebarToggler
      (click)="toggleSidebar($event)"
      aria-label="Toggle sidebar"
    >
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>

  <div
    class="sidebar-body"
    (mouseenter)="operSidebarFolded()"
    (mouseleave)="closeSidebarFolded()"
    [perfectScrollbar]
  >
    <ul class="sidebar-nav metismenu" id="sidebar-menu" #sidebarMenu>
      <!-- Logo Image (optional, shown only when expanded) -->
      <li class="nav-item text-center py-3" *ngIf="!isCollapsed">
        <img
          src="assets/images/logo.png"
          alt="Company Logo"
          width="160"
          class="img-fluid rounded shadow-sm"
        />
      </li>

      <!-- Menu Items -->
      <ng-container *ngFor="let item of menuItems; trackBy: trackByFn">
        <!-- Category Title -->
        <li class="nav-item nav-category" *ngIf="item.isTitle">
          {{ item.label }}
        </li>

        <!-- Main Menu Item -->
        <li class="nav-item" *ngIf="!item.isTitle">
          <!-- Parent with Children -->
          <a
            class="nav-link"
            *ngIf="item.showSubItems"
            href="javascript:void(0);"
            (click)="toggleSubmenu(item)"
            role="button"
            aria-expanded="item.expanded"
            [attr.aria-controls]="'submenu-' + item.id"
          >
            <i
              class="link-icon"
              [attr.data-feather]="item.icon"
              appFeatherIcon
            ></i>
            <span class="link-title">{{ item.label }}</span>
            <span class="link-arrow" data-feather="chevron-down"></span>
          </a>

          <!-- Leaf Link (No Children) -->
          <a
            class="nav-link nav-link-ref"
            [routerLink]="item.link"
            routerLinkActive="mm-active"
            [routerLinkActiveOptions]="{ exact: true }"
            *ngIf="!item.showSubItems && item.link"
            [attr.data-parent]="item.parentId"
          >
            <i
              class="link-icon"
              [attr.data-feather]="item.icon"
              appFeatherIcon
            ></i>
            <span class="link-title">{{ item.label }}</span>
            <span class="badge bg-{{ item.badge?.variant }}" *ngIf="item.badge">
              {{ item.badge.text }}
            </span>
          </a>

          <!-- Submenu -->
          <ul
            class="sidebar-nav sub-menu nav-second-level"
            *ngIf="item.showSubItems"
            [@submenu]="item.expanded ? 'open' : 'closed'"
            [id]="'submenu-' + item.id"
          >
            <li class="nav-item" *ngFor="let subitem of item.subItems">
              <!-- Subitem with Children -->
              <a
                class="nav-link side-nav-link-a-ref"
                *ngIf="subitem.showSubItems"
                href="javascript:void(0);"
                (click)="toggleSubSubmenu(subitem)"
                role="button"
              >
                <i
                  class="link-icon"
                  [attr.data-feather]="subitem.icon"
                  appFeatherIcon
                ></i>
                <span class="link-title">{{ subitem.label }}</span>
                <span class="link-arrow" data-feather="chevron-down"></span>
              </a>

              <!-- Leaf Subitem (Button disabled conditionally) -->
              <button
                *ngIf="!subitem.showSubItems"
                class="nav-link nav-link-ref"
                [disabled]="isDisabled(subitem.label)"
                [routerLink]="subitem.link"
                routerLinkActive="mm-active"
                [routerLinkActiveOptions]="{ exact: true }"
              >
                <i
                  class="link-icon"
                  [attr.data-feather]="subitem.icon"
                  appFeatherIcon
                ></i>
                <span class="link-title">{{ subitem.label }}</span>
              </button>

              <!-- Sub-submenu -->
              <ul
                class="sidebar-nav sub-menu nav-third-level"
                *ngIf="subitem.showSubItems"
                [@submenu]="subitem.expanded ? 'open' : 'closed'"
              >
                <li
                  class="nav-item"
                  *ngFor="let subSubitem of subitem.subItems"
                >
                  <a
                    class="nav-link nav-link-ref"
                    [routerLink]="subSubitem.link"
                    routerLinkActive="mm-active"
                  >
                    <i
                      class="link-icon"
                      [attr.data-feather]="subSubitem.icon"
                      appFeatherIcon
                    ></i>
                    {{ subSubitem.label }}
                  </a>
                </li>
              </ul>
            </li>
          </ul>
        </li>
      </ng-container>

      <!-- Footer -->
      <li class="nav-item nav-category powered-by">
        <small>Powered by <strong>ElSquare</strong></small>
      </li>
    </ul>
  </div>
</nav>
